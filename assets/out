#!/usr/bin/env bash

curl -X POST -d "1=1" http://requestb.in/14i248t1

set -e

exec 3>&1 # make stdout available as fd 3 for the result
exec 1>&2 # redirect all output to stderr for logging

curl -X POST -d "2=2" http://requestb.in/14i248t1

# for jq
PATH=/usr/local/bin:$PATH

curl -X POST -d "3=3" http://requestb.in/14i248t1

payload=$(mktemp /tmp/resource-in.XXXXXX)

curl -X POST -d "4=4" http://requestb.in/14i248t1

cat > $payload <&0

curl -X POST -d "5=5" http://requestb.in/14i248t1

build_url=$(jq -r '.params.build_url // ""' < $payload)

curl -X POST -d "6=6" http://requestb.in/14i248t1

curl -X POST -d "build_url=$build_url" http://requestb.in/14i248t1

echo '{"version":{"ref":"none"}}' >&3